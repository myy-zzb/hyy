<!-- miniprogram/components/anniversary-list/anniversary-list.wxml -->
<view class="modal" wx:if="{{show}}">
  <view class="modal-mask" bindtap="closeModal"></view>
  <view class="modal-content">
    <view class="modal-header">
      <text class="modal-title">çºªå¿µæ—¥</text>
      <view class="header-actions">
        <view class="add-btn" bindtap="openAddModal">ï¼‹</view>
        <view class="close-btn" bindtap="closeModal">âœ•</view>
      </view>
    </view>

    <view class="anniversaries-list" wx:if="{{!loading}}">
      <view class="empty" wx:if="{{anniversaries.length === 0}}">
        <text class="empty-icon">ğŸ“…</text>
        <text class="empty-text">æš‚æ— çºªå¿µæ—¥</text>
        <button class="empty-add-btn" bindtap="openAddModal">æ·»åŠ ç¬¬ä¸€ä¸ªçºªå¿µæ—¥</button>
      </view>

      <view class="anniversary-item" wx:for="{{anniversaries}}" wx:key="_id">
        <view class="item-content">
          <!-- ä½¿ç”¨ HTTPS ä¸´æ—¶é“¾æ¥ -->
          <view class="item-image-wrapper" wx:if="{{item.imageTempUrl}}">
            <image 
              src="{{item.imageTempUrl}}" 
              class="item-image" 
              mode="aspectFill"
              bindtap="previewImage"
              data-url="{{item.imageTempUrl}}"
            ></image>
          </view>
          
          <view class="item-info">
            <view class="item-header">
              <text class="item-title">{{item.title}}</text>
            </view>
            <view class="item-date">
              <text class="date-text">{{item.date}}</text>
              <text class="yearly-badge" wx:if="{{item.isYearly}}">æ¯å¹´</text>
            </view>
            <view class="item-description" wx:if="{{item.description}}">
              {{item.description}}
            </view>
            <view class="item-countdown">
              <text class="countdown-text">{{item.daysLeft}}</text>
            </view>
          </view>
        </view>
        <view class="item-actions">
          <view class="delete-btn" bindtap="deleteAnniversary" data-item="{{item}}">
            ğŸ—‘ï¸
          </view>
        </view>
      </view>
    </view>

    <view class="loading" wx:if="{{loading}}">
      <text>åŠ è½½ä¸­...</text>
    </view>
  </view>
</view>

<!-- æ·»åŠ çºªå¿µæ—¥å¼¹çª— -->
<view class="add-modal" wx:if="{{showAddModal}}">
  <view class="modal-mask" bindtap="closeAddModal"></view>
  <view class="add-modal-content">
    <view class="add-modal-header">
      <text class="add-modal-title">æ·»åŠ çºªå¿µæ—¥</text>
      <view class="close-btn" bindtap="closeAddModal">âœ•</view>
    </view>

    <view class="form">
      <view class="form-group">
        <text class="form-label">æ ‡é¢˜</text>
        <input
          class="form-input"
          placeholder="ä¾‹å¦‚ï¼šç¬¬ä¸€æ¬¡çº¦ä¼š"
          value="{{formData.title}}"
          bindinput="onTitleInput"
        />
      </view>

      <view class="form-group">
        <text class="form-label">æ—¥æœŸ</text>
        <picker mode="date" value="{{formData.date}}" bindchange="onDateChange">
          <view class="date-picker">{{formData.date}}</view>
        </picker>
      </view>

      <!-- å›¾ç‰‡ä¸Šä¼  -->
      <view class="form-group">
        <text class="form-label">çºªå¿µæ—¥å›¾ç‰‡</text>
        <view class="image-upload-container">
          <!-- ä½¿ç”¨ HTTPS ä¸´æ—¶é“¾æ¥æ˜¾ç¤ºé¢„è§ˆ -->
          <view class="image-preview" wx:if="{{formData.imageTempUrl}}">
            <image 
              src="{{formData.imageTempUrl}}" 
              class="preview-image" 
              mode="aspectFill"
              bindtap="previewImage"
              data-url="{{formData.imageTempUrl}}"
            ></image>
            <view class="delete-image-btn" bindtap="deleteImage" catchtap="deleteImage">
              âœ•
            </view>
          </view>
          <view class="upload-btn" wx:else bindtap="chooseImage">
            <text class="upload-icon">ğŸ“·</text>
            <text class="upload-text">{{uploadingImage ? 'ä¸Šä¼ ä¸­...' : 'ç‚¹å‡»ä¸Šä¼ å›¾ç‰‡'}}</text>
          </view>
        </view>
      </view>

      <view class="form-group">
        <text class="form-label">æè¿°ï¼ˆå¯é€‰ï¼‰</text>
        <textarea
          class="form-textarea"
          placeholder="æ·»åŠ ä¸€äº›æè¿°..."
          value="{{formData.description}}"
          bindinput="onDescriptionInput"
          maxlength="200"
        />
      </view>

      <view class="form-group checkbox-group">
        <label class="checkbox-label">
          <checkbox
            checked="{{formData.isYearly}}"
            bindchange="onYearlyChange"
          />
          <text>æ¯å¹´é‡å¤</text>
        </label>
      </view>

      <button class="submit-btn" bindtap="submitForm" disabled="{{uploadingImage}}">
        æ·»åŠ 
      </button>
    </view>
  </view>
</view>