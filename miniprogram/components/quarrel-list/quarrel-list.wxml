<!-- miniprogram/components/quarrel-list/quarrel-list.wxml -->
<view class="modal" wx:if="{{show}}">
  <view class="modal-mask" bindtap="closeModal"></view>
  <view class="modal-content">
    <view class="modal-header">
      <text class="modal-title">åµæ¶è®°å½• ğŸ’¢</text>
      <view class="header-actions">
        <view class="add-btn" bindtap="openAddModal">ï¼‹</view>
        <view class="close-btn" bindtap="closeModal">âœ•</view>
      </view>
    </view>

    <view class="stats-section">
      <view class="stat-item">
        <text class="stat-number">{{stats.total}}</text>
        <text class="stat-label">æ€»æ¬¡æ•°</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{stats.reconciled}}</text>
        <text class="stat-label">å·²å’Œå¥½</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{stats.unreconciled}}</text>
        <text class="stat-label">æœªå’Œå¥½</text>
      </view>
    </view>

    <view class="quarrels-list" wx:if="{{!loading}}">
      <view class="empty" wx:if="{{quarrels.length === 0}}">
        <text class="empty-icon">ğŸ•Šï¸</text>
        <text class="empty-text">è¿˜æ²¡æœ‰åµæ¶è®°å½•</text>
        <text class="empty-subtext">å¸Œæœ›ä¸€ç›´ä¿æŒè¿™ä¸ªçŠ¶æ€~</text>
      </view>

      <view class="quarrel-item" wx:for="{{quarrels}}" wx:key="_id" bindtap="viewDetail" data-quarrel="{{item}}">
        <view class="item-header">
          <view class="severity-badge" style="background: {{item.severityColor}}">
            <text class="severity-emoji">{{item.severityEmoji}}</text>
            <text class="severity-text">{{item.severityLabel}}</text>
          </view>
          <text class="item-mood">{{item.mood}}</text>
        </view>
        
        <view class="item-content">
          <view class="item-date">
            <text>ğŸ“… {{item.quarrelDate}} {{item.quarrelTime}}</text>
          </view>
          <view class="item-reason">{{item.reason}}</view>
          <view class="reconcile-status" wx:if="{{item.isReconciled}}">
            <text class="reconcile-tag">â¤ï¸ å·²å’Œå¥½</text>
          </view>
        </view>

        <view class="item-actions" catchtap="deleteQuarrel" data-quarrel="{{item}}">
          <text class="delete-icon">ğŸ—‘ï¸</text>
        </view>
      </view>
    </view>

    <view class="loading" wx:if="{{loading}}">
      <text>åŠ è½½ä¸­...</text>
    </view>
  </view>
</view>

<!-- æ·»åŠ è®°å½•å¼¹çª— - åœ¨æœ€å¤–å±‚é˜»æ­¢ç©¿é€ -->
<view class="add-modal" wx:if="{{showAddModal}}">
  <view class="modal-mask" bindtap="closeAddModal"></view>
  <view class="add-modal-content">
    <view class="add-modal-header">
      <text class="add-modal-title">è®°å½•ä¸€æ¬¡åµæ¶</text>
      <view class="close-btn" bindtap="closeAddModal">âœ•</view>
    </view>
    <!-- ç”¨ view æ›¿æ¢ scroll-view -->
    <view class="form-scroll">
      <view class="form">
        <view class="form-group">
          <text class="form-label">åµæ¶æ—¶é—´</text>
          <view class="datetime-row">
            <picker mode="date" value="{{formData.quarrelDate}}" bindchange="onDateChange" class="datetime-picker">
              <view class="picker-display">ğŸ“… {{formData.quarrelDate}}</view>
            </picker>
            <picker mode="time" value="{{formData.quarrelTime}}" bindchange="onTimeChange" class="datetime-picker">
              <view class="picker-display">ğŸ• {{formData.quarrelTime}}</view>
            </picker>
          </view>
        </view>

        <view class="form-group">
          <text class="form-label">åµæ¶åŸå› </text>
          <textarea
            class="form-textarea"
            placeholder="å†™ä¸‹åµæ¶çš„åŸå› ..."
            value="{{formData.reason}}"
            bindinput="onReasonInput"
            maxlength="200"
          />
        </view>

        <view class="form-group">
          <text class="form-label">TA è¯´çš„è¿‡åˆ†çš„è¯</text>
          <textarea
            class="form-textarea"
            placeholder="å¯¹æ–¹è¯´äº†ä»€ä¹ˆè®©ä½ ä¼¤å¿ƒçš„è¯..."
            value="{{formData.hurtfulWords}}"
            bindinput="onHurtfulWordsInput"
            maxlength="500"
          />
        </view>

        <view class="form-group">
          <text class="form-label">æˆ‘è¯´çš„è¿‡åˆ†çš„è¯</text>
          <textarea
            class="form-textarea"
            placeholder="æˆ‘è¯´äº†ä»€ä¹ˆè¿‡åˆ†çš„è¯..."
            value="{{formData.myWords}}"
            bindinput="onMyWordsInput"
            maxlength="500"
          />
        </view>

        <view class="form-group">
          <text class="form-label">ä¸¥é‡ç¨‹åº¦</text>
          <view class="severity-options">
            <view 
              class="severity-option {{formData.severity === item.value ? 'active' : ''}}" 
              wx:for="{{severityOptions}}" 
              wx:key="value"
              bindtap="selectSeverity"
              data-severity="{{item.value}}"
              style="border-color: {{item.color}}"
            >
              <text class="severity-option-emoji">{{item.emoji}}</text>
              <text class="severity-option-text">{{item.label}}</text>
            </view>
          </view>
        </view>

        <view class="form-group">
          <text class="form-label">å½“æ—¶å¿ƒæƒ…</text>
          <view class="mood-options">
            <view 
              class="mood-option {{formData.mood === item ? 'active' : ''}}" 
              wx:for="{{moodOptions}}" 
              wx:key="*this"
              bindtap="selectMood"
              data-mood="{{item}}"
            >
              {{item}}
            </view>
          </view>
        </view>

        <view class="form-group">
          <text class="form-label">å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰</text>
          <textarea
            class="form-textarea"
            placeholder="å…¶ä»–æƒ³è®°å½•çš„..."
            value="{{formData.note}}"
            bindinput="onNoteInput"
            maxlength="200"
          />
        </view>

        <button class="submit-btn" bindtap="submitForm">
          ä¿å­˜è®°å½•
        </button>
      </view>
    </view>
  </view>
</view>

<!-- è¯¦æƒ…å¼¹çª— - åŒæ ·å¤„ç† -->
<view class="detail-modal" wx:if="{{showDetailModal && currentQuarrel}}" catchtouchmove="preventTouchMove">
  <view class="modal-mask" bindtap="closeDetailModal" catchtouchmove="preventTouchMove"></view>
  <view class="detail-modal-content" catchtouchmove="stopPropagation">
    <view class="detail-header">
      <text class="detail-title">åµæ¶è¯¦æƒ…</text>
      <view class="close-btn" bindtap="closeDetailModal">âœ•</view>
    </view>

    <scroll-view class="detail-body" scroll-y enhanced show-scrollbar="{{false}}">
      <view class="detail-section">
        <view class="detail-time">
          <text class="detail-emoji">ğŸ“…</text>
          <text>{{currentQuarrel.quarrelDate}} {{currentQuarrel.quarrelTime}}</text>
        </view>
        <view class="detail-severity">
          <view class="severity-badge" style="background: {{currentQuarrel.severityColor}}">
            <text>{{currentQuarrel.severityEmoji}} {{currentQuarrel.severityLabel}}</text>
          </view>
          <text class="detail-mood">å¿ƒæƒ…: {{currentQuarrel.mood}}</text>
        </view>
      </view>

      <view class="detail-section">
        <text class="detail-label">ğŸ’­ åµæ¶åŸå› </text>
        <view class="detail-content">{{currentQuarrel.reason}}</view>
      </view>

      <view class="detail-section" wx:if="{{currentQuarrel.hurtfulWords}}">
        <text class="detail-label">ğŸ’” TA è¯´çš„è¿‡åˆ†çš„è¯</text>
        <view class="detail-content hurtful">{{currentQuarrel.hurtfulWords}}</view>
      </view>

      <view class="detail-section" wx:if="{{currentQuarrel.myWords}}">
        <text class="detail-label">ğŸ˜” æˆ‘è¯´çš„è¿‡åˆ†çš„è¯</text>
        <view class="detail-content hurtful">{{currentQuarrel.myWords}}</view>
      </view>

      <view class="detail-section" wx:if="{{currentQuarrel.note}}">
        <text class="detail-label">ğŸ“ å¤‡æ³¨</text>
        <view class="detail-content">{{currentQuarrel.note}}</view>
      </view>

      <view class="detail-section reconcile-section" wx:if="{{currentQuarrel.isReconciled}}">
        <text class="reconcile-success">â¤ï¸ å·²ç»å’Œå¥½å•¦~</text>
      </view>

      <button 
        class="reconcile-btn" 
        wx:if="{{!currentQuarrel.isReconciled}}"
        bindtap="markAsReconciled"
      >
        â¤ï¸ æ ‡è®°ä¸ºå·²å’Œå¥½
      </button>
    </scroll-view>
  </view>
</view>