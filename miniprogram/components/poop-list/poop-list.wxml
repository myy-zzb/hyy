<view class="modal" wx:if="{{show}}">
  <view class="modal-mask" bindtap="closeModal"></view>
  <view class="modal-content">
    <view class="modal-header">
      <text class="modal-title">æ‹‰å±è®°å½• ğŸ’©</text>
      <view class="header-actions">
        <view class="add-btn" bindtap="openAddModal">ï¼‹</view>
        <view class="close-btn" bindtap="closeModal">âœ•</view>
      </view>
    </view>

    <!-- ç»Ÿè®¡ä¿¡æ¯ -->
    <view class="stats-section">
      <view class="stat-item">
        <text class="stat-number">{{stats.total}}</text>
        <text class="stat-label">æ€»æ¬¡æ•°</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{stats.todayCount}}</text>
        <text class="stat-label">ä»Šæ—¥</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{stats.weekCount}}</text>
        <text class="stat-label">æœ¬å‘¨</text>
      </view>
    </view>

    <view class="poops-list" wx:if="{{!loading}}">
      <view class="empty" wx:if="{{poops.length === 0}}">
        <text class="empty-icon">ğŸš½</text>
        <text class="empty-text">è¿˜æ²¡æœ‰è®°å½•</text>
        <text class="empty-subtext">å…»æˆè®°å½•ä¹ æƒ¯ï¼Œå…³æ³¨è‚ é“å¥åº·~</text>
      </view>

      <view class="poop-item" wx:for="{{poops}}" wx:key="_id">
        <view class="item-header">
          <view class="user-info">
            <text class="user-name">{{item.userName}}</text>
            <text class="poop-type" style="color: {{item.typeColor}}">{{item.typeEmoji}} {{item.typeLabel}}</text>
          </view>
          <text class="feeling-emoji">{{item.feelingEmoji}}</text>
        </view>
        
        <view class="item-content">
          <view class="item-date">
            <text>ğŸ“… {{item.poopDate}} {{item.poopTime}}</text>
          </view>
          <view class="item-info-row">
            <text class="info-tag">{{item.locationEmoji}} {{item.locationLabel}}</text>
            <text class="info-tag">â±ï¸ {{item.duration}}åˆ†é’Ÿ</text>
          </view>
          <view class="item-warning" wx:if="{{item.hasBlood}}">
            <text>âš ï¸ å¸¦è¡€ï¼Œå»ºè®®å°±åŒ»</text>
          </view>
        </view>

        <view class="item-actions" catchtap="deletePoop" data-poop="{{item}}">
          <text class="delete-icon">ğŸ—‘ï¸</text>
        </view>
      </view>
    </view>

    <view class="loading" wx:if="{{loading}}">
      <text>åŠ è½½ä¸­...</text>
    </view>
  </view>
</view>

<!-- æ·»åŠ è®°å½•å¼¹çª— - åœ¨æœ€å¤–å±‚é˜»æ­¢ç©¿é€ -->
<view class="add-modal" wx:if="{{showAddModal}}">
  <view class="modal-mask" bindtap="closeAddModal"></view>
  <view class="add-modal-content">
    <view class="add-modal-header">
      <text class="add-modal-title">è®°å½•æ‹‰å± ğŸ’©</text>
      <view class="close-btn" bindtap="closeAddModal">âœ•</view>
    </view>

    <!-- ç”¨ view æ›¿æ¢ scroll-view -->
    <view class="form-scroll">
      <view class="form">
        <view class="form-group">
          <text class="form-label">æ‹‰å±æ—¶é—´</text>
          <view class="datetime-row">
            <picker mode="date" value="{{formData.poopDate}}" bindchange="onDateChange" class="datetime-picker">
              <view class="picker-display">ğŸ“… {{formData.poopDate}}</view>
            </picker>
            <picker mode="time" value="{{formData.poopTime}}" bindchange="onTimeChange" class="datetime-picker">
              <view class="picker-display">ğŸ• {{formData.poopTime}}</view>
            </picker>
          </view>
        </view>

        <view class="form-group">
          <text class="form-label">ä¾¿ä¾¿ç±»å‹</text>
          <view class="type-options">
            <view 
              class="type-option {{formData.poopType === item.value ? 'active' : ''}}" 
              wx:for="{{poopTypeOptions}}" 
              wx:key="value"
              bindtap="selectPoopType"
              data-type="{{item.value}}"
              style="border-color: {{item.color}}"
            >
              <text class="type-emoji">{{item.emoji}}</text>
              <text class="type-text">{{item.label}}</text>
            </view>
          </view>
        </view>

        <view class="form-group">
          <text class="form-label">è¹²å‘æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰</text>
          <slider 
            min="1" 
            max="60" 
            value="{{formData.duration}}" 
            show-value
            bindchange="onDurationChange"
            activeColor="#667eea"
          />
        </view>

        <view class="form-group">
          <text class="form-label">æ‹‰å®Œæ„Ÿè§‰</text>
          <view class="feeling-options">
            <view 
              class="feeling-option {{formData.feeling === item.value ? 'active' : ''}}" 
              wx:for="{{feelingOptions}}" 
              wx:key="value"
              bindtap="selectFeeling"
              data-feeling="{{item.value}}"
            >
              <text class="feeling-emoji">{{item.emoji}}</text>
              <text class="feeling-text">{{item.label}}</text>
            </view>
          </view>
        </view>

        <view class="form-group">
          <text class="form-label">æ‹‰å±åœ°ç‚¹</text>
          <view class="location-options">
            <view 
              class="location-option {{formData.location === item.value ? 'active' : ''}}" 
              wx:for="{{locationOptions}}" 
              wx:key="value"
              bindtap="selectLocation"
              data-location="{{item.value}}"
            >
              <text class="location-emoji">{{item.emoji}}</text>
              <text class="location-text">{{item.label}}</text>
            </view>
          </view>
        </view>

        <view class="form-group">
          <text class="form-label">ä¾¿ä¾¿é¢œè‰²</text>
          <view class="color-options">
            <view 
              class="color-option {{formData.color === item.value ? 'active' : ''}}" 
              wx:for="{{colorOptions}}" 
              wx:key="value"
              bindtap="selectColor"
              data-color="{{item.value}}"
            >
              <view class="color-circle" style="background: {{item.color}}"></view>
              <text class="color-text">{{item.label}}</text>
            </view>
          </view>
        </view>

        <view class="form-group">
          <text class="form-label">æ°”å‘³ç­‰çº§</text>
          <view class="smell-options">
            <view 
              class="smell-option {{formData.smell === item.value ? 'active' : ''}}" 
              wx:for="{{smellOptions}}" 
              wx:key="value"
              bindtap="selectSmell"
              data-smell="{{item.value}}"
            >
              <text class="smell-emoji">{{item.emoji}}</text>
              <text class="smell-text">{{item.label}}</text>
            </view>
          </view>
        </view>

        <view class="form-group">
          <view class="blood-check">
            <text class="form-label">æ˜¯å¦å¸¦è¡€</text>
            <switch checked="{{formData.hasBlood}}" bindchange="toggleBlood" color="#ff6b6b"/>
          </view>
          <view class="blood-warning" wx:if="{{formData.hasBlood}}">
            <text>âš ï¸ å»ºè®®åŠæ—¶å°±åŒ»æ£€æŸ¥</text>
          </view>
        </view>

        <view class="form-group">
          <text class="form-label">å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰</text>
          <textarea
            class="form-textarea"
            placeholder="è®°å½•å…¶ä»–ä¿¡æ¯..."
            value="{{formData.note}}"
            bindinput="onNoteInput"
            maxlength="200"
          />
        </view>

        <button class="submit-btn" bindtap="submitForm">
          ä¿å­˜è®°å½•
        </button>
      </view>
    </view>
  </view>
</view>